<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Crear Usuario</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/login.css') }}">
  <style>
    .page { max-width: 680px; margin: 32px auto; background: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 8px 24px rgba(2,6,23,.08); }
    .page h1 { margin-top: 0; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .row-1 { display: grid; grid-template-columns: 1fr; gap: 12px; }
    label { font-weight: 600; display:block; margin-bottom: 6px; }
    input, select { width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; }
    fieldset { border: 1px solid #e2e8f0; border-radius: 8px; padding: 12px; }
    .pages { display: grid; grid-template-columns: 1fr 1fr; gap: 6px 12px; }
    .actions { margin-top: 16px; display: flex; gap: 12px; }
    .btn { padding: 10px 16px; border-radius: 8px; border: 1px solid #cbd5e1; background:#0ea5e9; color:#fff; font-weight: 700; cursor: pointer; }
    .btn.secondary { background:#fff; color:#0f172a; }
    .msg { margin-top: 12px; font-weight: 600; }
    .msg.ok { color: #16a34a; }
    .msg.err { color: #dc2626; }
  </style>
</head>
<body>
  <div class="page">
    <h1>Crear Usuario</h1>
    <p>Solo disponible para <strong>encargado</strong> o <strong>auditor</strong>.</p>

    <form id="createUserForm" autocomplete="off">
      <div class="row">
        <div>
          <label for="username">Usuario</label>
          <input id="username" name="username" required placeholder="Ej: mateo">
        </div>
        <div>
          <label for="password">Contraseña</label>
          <input id="password" name="password" type="password" required placeholder="Mínimo 4 caracteres">
        </div>
      </div>

      <div class="row">
        <div>
          <label for="role">Rol</label>
          <select id="role" name="role" required>
            <option value="">-- Seleccionar --</option>
            <option value="cajero">Cajero</option>
            <option value="encargado">Encargado</option>
            <option value="auditor">Auditor</option>
          </select>
        </div>
        <div>
          <label for="status">Estado</label>
          <select id="status" name="status" required>
            <option value="active" selected>Activo</option>
            <option value="inactive">Inactivo</option>
          </select>
        </div>
      </div>

      <div class="row-1">
        <div>
          <label for="local">Local Principal (obligatorio)</label>
          <input id="local" name="local" required placeholder="Ej: Ribs Infanta">
          <small style="color: #64748b; font-size: 12px;">Este será el local por defecto del usuario</small>
        </div>
      </div>

      <!-- NUEVO: Selector de múltiples locales -->
      <fieldset style="margin-top:12px;" id="multiLocalFieldset">
        <legend style="padding:0 6px;">Locales Adicionales (opcional - solo para Encargados)</legend>
        <div id="localesAdicionalesContainer" style="margin-bottom: 12px;">
          <small style="color: #64748b; display: block; margin-bottom: 8px;">
            Agrega más locales si este usuario necesita gestionar múltiples locales
          </small>
          <div id="localesList" style="display: flex; flex-direction: column; gap: 8px;">
            <!-- Locales adicionales se agregarán aquí dinámicamente -->
          </div>
          <button type="button" id="btnAgregarLocal" class="btn secondary" style="margin-top: 8px; width: 100%;">
            + Agregar otro local
          </button>
        </div>
      </fieldset>

      <div class="row-1">
        <div>
          <label for="society">Sociedad</label>
          <input id="society" name="society" required placeholder="Ej: Ribs SA">
        </div>
      </div>

      <fieldset style="margin-top:12px;">
        <legend style="padding:0 6px;">Páginas (accesos)</legend>
        <div class="pages">
          <label><input type="checkbox" class="page-chk" value="index" checked> index</label>
          <label><input type="checkbox" class="page-chk" value="reporte_remesas" checked> reporte_remesas</label>
          <label><input type="checkbox" class="page-chk" value="resumen_local" checked> resumen_local</label>
        </div>
      </fieldset>

      <div class="actions">
        <button type="submit" class="btn">Crear</button>
        <button type="button" class="btn secondary" id="btnReset">Limpiar</button>
      </div>

      <div id="formMsg" class="msg" role="status" aria-live="polite"></div>
    </form>
  </div>

  <script src="{{ url_for('static', filename='js/create_user.js') }}"></script>
</body>
</html>
